job_globals:
  site: site-name 

components:
  event_fetchers:
    - type: ga4_base 
      params:
        gcp_project_id: gcp-project-id
        site_ga4_property_id: "123456789"
  page_fetchers:
    - type: wp_base 
      params:
        url_prefix: https://example.com
        slug_from_path_regex: ^/20\d{2}/(0[1-9]|1[012])/(?P<slug>[a-zA-Z\d\-%]+)/$ 
        language_from_path_regex: 
          es: ^/es/.*/$ 
        tag_id_republished_content: 42 
        request_maximum_attempts: 10 
        request_maximum_backoff: 60 
  page_writers:
    - type: postgres_base
      params:
        env_db_url: POSTGRES_DB_URL 
        force_update_despite_latest: false 
  traffic_based_article_recommenders:
    - type: popularity
      params:
        env_db_url: POSTGRES_DB_URL
        max_recommendations: 20
  recommendation_writers:
    - type: postgres_base
      params:
        env_db_url: POSTGRES_DB_URL

tasks:
  - type: update_pages
    components:
      event_fetcher: ga4_base
      page_fetcher: wp_base
      page_writer: postgres_base
    params:
      date_end: 2023-12-07 
      days_to_fetch_events: 7 
      days_to_fetch_events_per_batch: 2
  - type: create_traffic_based_recommendations
    components:
      event_fetcher: ga4_base
      recommender: popularity
      recommendation_writer: postgres_base
    params:
      date_end: 2023-12-07 
      days_to_fetch_events: 7 
